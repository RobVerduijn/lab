instance-id: {{ guest['key'].split('.')[0] }}
{#local-hostname: {{ guest }}#}

{% if guests[guest['key']]['network_connections'][0]['ip']['address'] is defined -%}
{%   if guests[guest['key']]['guest_def']['dist_family'] == 'RedHat' %}
network-interfaces: |
  auto {{ guests[guest['key']]['network_connections'][0]['name'] }}  
  iface {{ guests[guest['key']]['network_connections'][0]['name'] }} inet static
  address {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('address') }}
  network {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('network') }}
  netmask {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('netmask') }}
  broadcast {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('broadcast') }}
  gateway {{ guests[guest['key']]['network_connections'][0]['ip']['gateway4']  }}
  dns-nameservers {{ guests[guest['key']]['network_connections'][0]['ip']['dns'] | join(' ') }}
  dns-search {{ guests[guest['key']]['network_connections'][0]['ip']['dns_search'] | join(' ') }}
{%  elif guests[guest['key']]['guest_def']['dist_family'] == 'Windows' %}
network-interfaces: |
  iface {{ guests[guest['key']]['network_connections'][0]['name'] }} inet static
  address {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('address') }}
  network {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('network') }}
  netmask {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('netmask') }}
  broadcast {{ guests[guest['key']]['network_connections'][0]['ip']['address'][0] | ansible.netcommon.ipaddr('broadcast') }}
  gateway {{ guests[guest['key']]['network_connections'][0]['ip']['gateway4']  }}
  dns-nameservers {{ guests[guest['key']]['network_connections'][0]['ip']['dns'] | join(' ') }}
  dns-search {{ guests[guest['key']]['network_connections'][0]['ip']['dns_search'] | join(' ') }}
hostname: {{ guest['key'].split('.')[0] }}
{%  endif %}
{% endif %}
